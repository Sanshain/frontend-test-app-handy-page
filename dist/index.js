!function(){"use strict";function e(e){const t=Math.floor(e/6)+1;document.body.style.backgroundImage=`url(https://raw.githubusercontent.com/digitalSector47/traineeship-test-task/refs/heads/main/images/0${t}.jpg)`}const t=document.getElementById("time"),o=document.getElementById("date");function n(){const e=new Date;return t.textContent=e.toLocaleTimeString("ru",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),o.textContent=e.toLocaleDateString("ru",{day:"2-digit",month:"long"})+", "+e.toLocaleDateString("ru",{weekday:"long"}),e}const i=document.querySelector(".precipitation"),c=document.querySelector(".temperature");let l=localStorage.getItem("city");if(l){document.querySelector(".city__name").textContent=l;const{lat:e,lon:t}=JSON.parse(localStorage.getItem("coordinates"));a(e,t)}else navigator.geolocation.getCurrentPosition((async function(e){const{latitude:t,longitude:o}=e.coords,n=await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${t}&longitude=${o}&localityLanguage=ru`),{city:i}=await n.json();localStorage.setItem("city",i),localStorage.setItem("coordinates",JSON.stringify({lat:t,lon:o})),document.querySelector(".city__name").textContent=i,await a(t,o)}));async function a(e,t){const o=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&current=${["temperature_2m","precipitation_probability","precipitation","rain","showers","snowfall","snow_depth","weather_code","cloud_cover","cloud_cover_low","cloud_cover_mid","cloud_cover_high"].join(",")}`;await fetch(o).then((e=>e.ok?e.json():{then:()=>{}})).then((e=>{const{current:t}=e;let o="sun";t.snowfall?o="snow":t.rain?o="rain":t.cloud_cover&&(o="cloudy"),globalThis.debug&&console.log(t),i.src=`/image/${o}.png`,c.textContent=t.temperature_2m+"℃"}))}function s(e,t,o){const n=e.appendChild(document.createElement(t));return Object.keys(o).forEach((e=>{n[e]=o[e]})),n}const r=document.getElementById("tasks"),u=document.querySelector(".menu"),d=document.querySelector(".sub_menu"),m=document.querySelector(".delete_all"),g=document.querySelector(".task_list"),y=g.querySelector("input"),f=g.querySelector("ul"),h=function(){const e=localStorage.getItem("tasks");return e?JSON.parse(e):[]}();h.forEach(S);const p=new Proxy(h,{set:(e,t,o)=>(e[t]=o,Number.parseInt(t)>-1&&"object"==typeof o&&(S(o),v()),!0)});function S(e){const t=f.appendChild(document.createElement("li")),o=s(t,"input",{type:"checkbox",checked:e.done}),n=s(t,"h4",{textContent:e.title,className:e.done?"done":""}),i=s(t,"div",{className:"delete_task"});o.onchange=t=>{e.done=o.checked,localStorage.setItem("tasks",JSON.stringify(h.filter(Boolean))),n.classList.toggle("done"),y.focus()},e.view=t,i.onclick=()=>{const o=h.indexOf(e);(h[o].done||confirm("The task still is not done. Are you sure you want to remove it?"))&&(t.parentElement.removeChild(t),delete h[o],v(),y.focus())}}function v(){localStorage.setItem("tasks",JSON.stringify(h.filter(Boolean)))}y.onkeydown=e=>{"Enter"==e.key&&(y.value?(p.push({title:y.value,done:!1}),y.value=""):alert("Введите название задачи"))},u.onfocus=()=>d.style.visibility="visible",u.onblur=()=>setTimeout((()=>d.style.visibility="hidden"),150),r.onclick=()=>{g.classList.contains("visible")?(g.style.opacity="0",setTimeout((()=>g.classList.toggle("visible")))):(g.classList.toggle("visible"),setTimeout((()=>{g.style.opacity=".95"})),setTimeout((()=>y.focus()),50))},m.onclick=()=>{if(h.filter((e=>e.done)).length&&confirm("Are sure you want delete all done tasks?")){for(let e=h.length-1;e>=0;e--)h[e]&&h[e].done&&(h[e].view.remove(),delete h[e]);v()}},e(n().getHours()),setInterval((()=>{const t=n(),o=t.getHours();0===t.getMinutes()&&o%6==0&&e(o)}),1e3)}();
