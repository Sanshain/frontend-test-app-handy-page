!function(){"use strict";function e(e){const t=Math.floor(e/6)+1;document.body.style.backgroundImage=`url(https://raw.githubusercontent.com/digitalSector47/traineeship-test-task/refs/heads/main/images/0${t}.jpg)`}const t=document.getElementById("time"),o=document.getElementById("date");function n(){const e=new Date;return t.textContent=e.toLocaleTimeString("ru",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),o.textContent=e.toLocaleDateString("ru",{day:"2-digit",month:"long"})+", "+e.toLocaleDateString("ru",{weekday:"long"}),e}const c=document.querySelector(".precipitation"),i=document.querySelector(".temperature");async function l(e,t,o){const n=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&current=${["temperature_2m","precipitation_probability","precipitation","rain","showers","snowfall","snow_depth","weather_code","cloud_cover","cloud_cover_low","cloud_cover_mid","cloud_cover_high"].join(",")}`;await fetch(n).then((e=>e.ok?e.json():{then:()=>{}})).then((e=>{const{current:t}=e;let o="sun";t.snowfall?o="snow":t.rain?o="rain":t.cloud_cover&&(o="cloudy"),globalThis.debug&&console.log(t),c.src=`./image/${o}.png`,i.textContent=t.temperature_2m+"℃"}))}let s=localStorage.getItem("city");if(s){document.querySelector(".city__name").textContent=s;const{lat:e,lon:t}=JSON.parse(localStorage.getItem("coordinates"));l(e,t)}else navigator.geolocation.getCurrentPosition((async function(e){const{latitude:t,longitude:o}=e.coords,n=await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${t}&longitude=${o}&localityLanguage=ru`),{city:c}=await n.json();localStorage.setItem("city",c),localStorage.setItem("coordinates",JSON.stringify({lat:t,lon:o})),document.querySelector(".city__name").textContent=c,await l(t,o)}));function a(e,t,o){const n=e.appendChild(document.createElement(t));return Object.keys(o).forEach((e=>{n[e]=o[e]})),n}const r=function(){const e=localStorage.getItem("tasks");return e?JSON.parse(e):[]}();function u(){localStorage.setItem("tasks",JSON.stringify(r.filter(Boolean)))}const d=document.getElementById("tasks"),m=document.querySelector(".menu"),g=document.querySelector(".sub_menu"),y=document.querySelector(".delete_all"),f=document.querySelector(".task_list"),h=f.querySelector("input"),p=f.querySelector("ul");function S(e){const t=p.appendChild(document.createElement("li")),o=a(t,"input",{type:"checkbox",checked:e.done}),n=a(t,"h4",{textContent:e.title,className:e.done?"done":""}),c=a(t,"div",{className:"delete_task"});o.onchange=t=>{e.done=o.checked,localStorage.setItem("tasks",JSON.stringify(r.filter(Boolean))),n.classList.toggle("done"),h.focus()},e.view=t,c.onclick=()=>{const o=r.indexOf(e);(r[o].done||confirm("The task still is not done. Are you sure you want to remove it?"))&&(t.parentElement.removeChild(t),delete r[o],u(),h.focus())}}m.onfocus=()=>g.style.visibility="visible",m.onblur=()=>setTimeout((()=>g.style.visibility="hidden"),150),d.onclick=()=>{f.classList.contains("visible")?(f.style.opacity="0",setTimeout((()=>f.classList.toggle("visible")))):(f.classList.toggle("visible"),setTimeout((()=>{f.style.opacity=".95"})),setTimeout((()=>h.focus()),50))},y.onclick=()=>{if(r.filter((e=>e.done)).length&&confirm("Are sure you want delete all done tasks?")){for(let e=r.length-1;e>=0;e--)r[e]&&r[e].done&&(r[e].view.remove(),delete r[e]);u()}},r.forEach(S);const v=new Proxy(r,{set:(e,t,o)=>(e[t]=o,Number.parseInt(t)>-1&&"object"==typeof o&&(S(o),u()),!0)});h.onkeydown=e=>{"Enter"==e.key&&(h.value?(v.push({title:h.value,done:!1}),h.value=""):alert("Введите название задачи"))},e(n().getHours()),setInterval((()=>{const t=n(),o=t.getHours();0===t.getMinutes()&&o%6==0&&e(o)}),1e3)}();
